<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seonyul Diary</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <h1>Seonyul Diary</h1>

    <form id="diary-form">
      <input type="text" id="title" placeholder="Title" required />
      <textarea id="content" placeholder="Content" required></textarea>
      <button type="submit">Save</button>
    </form>

    <div id="entries"></div>
  </div>

  <script>
    // ★ 새 프로젝트용 Firebase 설정값
    const firebaseConfig = {
      apiKey: "AIzaSyAT9KX860C-LWcce69VouUbMXg3ah6BVXk",
      authDomain: "system-384a7.firebaseapp.com",
      projectId: "system-384a7",
      storageBucket: "system-384a7.appspot.com",
      messagingSenderId: "155681313154",
      appId: "1:155681313154:web:5086b477aece518d6bbf9b",
      measurementId: "G-59GV7Q9BZ0"
    };

    // 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById('diary-form');
    const entriesDiv = document.getElementById('entries');

    // 실시간 리스너
    db.collection("diaryEntries")
      .orderBy("date", "desc")
      .onSnapshot(snapshot => {
        entriesDiv.innerHTML = '';
        snapshot.docs.forEach(doc => {
          const d = doc.data();
          // date 필드가 준비될 때만 렌더
          if (!d.date || typeof d.date.toDate !== 'function') return;
          const humanDate = d.date.toDate().toLocaleString();
          entriesDiv.innerHTML += `
            <div>
              <strong>${d.title}</strong> (${humanDate})<br>
              ${d.content}
            </div><hr>
          `;
        });
      });

    // 데이터 쓰기
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const title   = document.getElementById('title').value;
      const content = document.getElementById('content').value;

      try {
        await db.collection("diaryEntries").add({
          title,
          content,
          date: firebase.firestore.FieldValue.serverTimestamp()
        });
        form.reset();
      } catch (err) {
        console.error("저장 실패:", err);
        alert("Firebase 저장 실패!");
      }
    });
  </script>
</body>
</html>
