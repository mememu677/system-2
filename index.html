<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SeonYul System Diary</title>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>SeonYul System Diary</h1>
      <nav>
        <button id="tab-diary" class="tab active">Diary</button>
        <button id="tab-health" class="tab">Health Check</button>
        <button id="tab-memo" class="tab">Memo</button>
        <button id="tab-wh" class="tab">Working Holiday</button>
      </nav>
    </header>

    <!-- Diary Section -->
    <section id="diary-section">
      <div id="category-filters"></div>
      <form id="diary-form">
        <input type="text" id="diary-title" placeholder="Title" required />
        <select id="diary-category" required>
          <option value="General">General</option>
          <option value="Health">Health</option>
          <option value="Schedule">Schedule</option>
          <option value="Record">Record</option>
          <option value="Chat">Chat</option>
        </select>
        <textarea id="diary-content" placeholder="Content" required></textarea>
        <button type="submit">Post</button>
      </form>
      <div id="diary-entries"></div>
    </section>

    <!-- 나머지 Section은 그대로 유지 -->
    <section id="health-section" style="display:none;">
      <div id="health-tag-filters"></div>
      <form id="health-form">
        <textarea id="health-memo" placeholder="Memo (optional)" rows="2"></textarea>
        <button type="submit">Submit</button>
      </form>
      <div id="health-entries"></div>
    </section>

    <section id="memo-section" style="display:none;">
      <form id="memo-form">
        <input type="text" id="memo-title" placeholder="Title" required />
        <textarea id="memo-content" placeholder="Memo" required></textarea>
        <button type="submit">Save</button>
      </form>
      <div id="memo-entries"></div>
    </section>

    <section id="wh-section" style="display:none;">
      <div id="wh-tag-filters"></div>
      <form id="wh-form">
        <select id="wh-title" required>
          <option value="Planning">Planning</option>
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
          <option value="English Study">English Study</option>
        </select>
        <textarea id="wh-content" placeholder="Content" required></textarea>
        <button type="submit">Post</button>
      </form>
      <div id="wh-entries"></div>
    </section>

    <!-- Firebase 연결 및 글쓰기 -->
    <script>
      // Firebase 설정
      const firebaseConfig = {
        apiKey: "AIzaSyA41qntUR_bkZT2kTGYG5lAHbguR8_5Sbk",
        authDomain: "seonyulsystem.firebaseapp.com",
        projectId: "seonyulsystem",
        storageBucket: "seonyulsystem.firebasestorage.app",
        messagingSenderId: "938459461117",
        appId: "1:938459461117:web:9f3681a7ec5796472f5594"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      document.addEventListener('DOMContentLoaded', () => {
        // 탭 전환
        function showSection(id) {
          document.querySelectorAll('section').forEach(s => s.style.display = 'none');
          document.getElementById(id).style.display = '';
        }
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            showSection(tab.id.replace('tab-', '') + '-section');
          });
        });

        // Diary 카테고리 필터
        const diaryCats = ['All', 'General', 'Health', 'Schedule', 'Record', 'Chat'];
        const catDiv = document.getElementById('category-filters');
        diaryCats.forEach(cat => {
          const b = document.createElement('button');
          b.className = 'cat-btn';
          b.innerText = cat;
          b.addEventListener('click', () => {
            document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
            renderDiary();
          });
          catDiv.appendChild(b);
        });
        catDiv.firstChild.classList.add('active');

        // 글 불러오기
        async function renderDiary() {
          const active = document.querySelector('.cat-btn.active').innerText;
          const snapshot = await db.collection("diaryEntries").orderBy("date", "desc").get();
          const filtered = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))
            .filter(e => active === 'All' || e.category === active);

          const diaryDiv = document.getElementById('diary-entries');
          diaryDiv.innerHTML = filtered.map(e => `
            <div class="entry">
              <div class="entry-header">
                <span class="entry-date">${new Date(e.date.toDate()).toLocaleString()}</span>
                <span class="entry-title">[${e.category}] ${e.title}</span>
              </div>
              <div class="entry-content">${e.content}</div>
            </div>
          `).join('');
        }

        // 글 저장
        const diaryForm = document.getElementById('diary-form');
        diaryForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const title = document.getElementById('diary-title').value;
          const category = document.getElementById('diary-category').value;
          const content = document.getElementById('diary-content').value;
          const date = new Date(); // Firebase timestamp로 저장

          await db.collection("diaryEntries").add({ title, category, content, date });
          diaryForm.reset();
          renderDiary();
        });

        renderDiary();
      });
    </script>
  </div>
</body>
</html>
